(function () {
    "use strict";
    const CARDS_CONTAINER = document.getElementById("cardsContainer");
    const API_KEY = "ce0e55ad125d4dabba067f72f6fcfc66";
    const API_PATH = "https://api.rawg.io/api/";
    let cardsArray = [];

    async function getData(url) {
        const response = await fetch(url);

        if (!response.ok) {
            throw new Error(
                `Cannot fetch the data, error with status ${response.status}`
            );
        }

        const data = await response.json();
        return data;
    }

    async function displayGames() {
        cardsArray = await getData(`${API_PATH}games?key=${API_KEY}`)
            .then((data) => data.results)
            .catch((err) => err.message);

        let gamesTemplate = ``;

        const PLATFORM_ICONS = {
            pc: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="desktop platform icon">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M24 11H11V1.84376L24 0V11ZM10 2V11H0V3.33438L10 2ZM10 12H0V20.519L10 22V12ZM11 21.9914V12H24V24L11 21.9914Z" fill="#515151"/>
                </svg>`,
            playstation: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="playstation platform icon">
                <path d="M9.55164 1.49997L9.55164 19.7774L13.3604 21.0885L13.3604 5.76315C13.3604 5.041 13.6567 4.56152 14.132 4.72642C14.7534 4.91369 14.8742 5.57892 14.8742 6.29304L14.8742 12.4137C17.2449 13.6606 19.1114 12.4131 19.1114 9.12343C19.1114 5.76185 18.0171 4.26432 14.7972 3.06029C13.5272 2.6008 11.1734 1.82542 9.55164 1.49997Z" fill="#515151"/>
                <path d="M14.3503 18.4129L20.1076 15.8203C20.7589 15.5148 20.8585 15.0998 20.3314 14.8817C19.796 14.6596 18.8404 14.7232 18.1821 15.0222L14.3503 16.7324V14.0036L14.5698 13.912C14.5698 13.912 15.6789 13.4148 17.239 13.2008C18.796 12.9848 20.7055 13.2289 22.2063 13.9446C23.8969 14.6241 24.0864 15.6153 23.6587 16.3051C23.2247 16.9877 22.1726 17.4815 22.1726 17.4815L14.3503 21.0367" fill="#515151"/>
                <path d="M1.7099 18.7146C-0.0868737 18.1444 -0.386499 16.9395 0.43318 16.2435C1.18927 15.6079 2.47692 15.1295 2.47692 15.1295L7.79976 12.9675V15.4281L3.9729 16.9908C3.29503 17.267 3.1934 17.6557 3.7394 17.859C4.29515 18.0706 5.28142 18.0137 5.95967 17.7286L7.79976 16.9728V19.1695C7.68115 19.1921 7.54929 19.215 7.42893 19.2384C5.59431 19.5852 3.63972 19.4428 1.7099 18.7146Z" fill="#515151"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M23.7661 20.9589C23.6149 21.1145 23.4164 21.2024 23.2027 21.2024C22.989 21.2024 22.784 21.1145 22.6326 20.9589C22.4831 20.8005 22.4004 20.5936 22.4004 20.3706C22.4004 19.9089 22.7591 19.5357 23.2027 19.5357C23.4164 19.5357 23.6149 19.6208 23.7661 19.7798C23.9156 19.9352 24 20.1456 24 20.3706C24 20.5936 23.9156 20.8005 23.7661 20.9589ZM22.5352 20.3705C22.5352 20.1807 22.6034 20.0065 22.7279 19.8775C22.8555 19.7456 23.0258 19.6745 23.2027 19.6745C23.3798 19.6745 23.5458 19.7456 23.6704 19.8775C23.796 20.0065 23.8638 20.1807 23.8638 20.3705C23.8638 20.7509 23.567 21.0597 23.2027 21.0597C23.0258 21.0597 22.8555 20.9894 22.7279 20.8592C22.6034 20.7279 22.5352 20.5557 22.5352 20.3705ZM23.5678 20.7168C23.5749 20.7383 23.5836 20.751 23.5959 20.7548L23.6071 20.7613V20.8142H23.4335L23.4303 20.8036L23.4185 20.7716C23.4165 20.7548 23.4142 20.7327 23.4118 20.6957L23.4041 20.5507C23.4021 20.4993 23.386 20.4694 23.3562 20.4495C23.3341 20.4419 23.304 20.4359 23.2591 20.4359H23.0181V20.8142H22.86V19.8849H23.2745C23.3422 19.8849 23.3991 19.8974 23.4427 19.9167C23.5301 19.9595 23.5749 20.0367 23.5749 20.1454C23.5749 20.1987 23.5622 20.2487 23.5403 20.2855C23.5213 20.3115 23.4989 20.3353 23.4744 20.3584L23.4809 20.3632C23.4975 20.3753 23.5139 20.3873 23.5236 20.405C23.5457 20.4305 23.5557 20.4731 23.5575 20.5279L23.5615 20.6463C23.5622 20.6766 23.5645 20.7002 23.5678 20.7168ZM23.3808 20.2599C23.4064 20.2427 23.4185 20.2084 23.4185 20.1561C23.4185 20.1009 23.4002 20.064 23.3643 20.0457C23.3422 20.0367 23.3147 20.0302 23.2779 20.0302H23.0181V20.2913H23.2636C23.3124 20.2913 23.3512 20.2808 23.3808 20.2599Z" fill="#515151"/>
                </svg>`,
            xbox: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="xbox platform icon">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12.6 3C14.4514 3 15.9829 3.5916 17.3771 4.58655C17.4 4.58655 17.4 4.61345 17.4 4.64034C17.4 4.66723 17.3771 4.66723 17.3543 4.66723C15.5714 4.21008 12.8743 6.01176 12.6229 6.2H12.6H12.5771C12.3257 6.01176 9.62857 4.21008 7.84571 4.66723C7.82286 4.66723 7.8 4.66723 7.8 4.64034C7.8 4.61345 7.8 4.58655 7.82286 4.58655C9.21714 3.5916 10.7486 3 12.6 3ZM18.7348 19.8948C20.1748 18.4046 15.4137 13.1422 12.6035 11C12.6035 11 12.5803 11 12.5803 11.0233C9.7933 13.1422 5.00901 18.4046 6.47217 19.8948C8.0979 21.3385 10.2578 22.2 12.6035 22.2C14.9492 22.2 17.0859 21.3385 18.7348 19.8948ZM5.63014 6.24559C5.61918 6.24559 5.6137 6.25161 5.60822 6.25763C5.60274 6.26364 5.59726 6.26966 5.5863 6.26966C3.9863 8.0264 3 10.457 3 13.1282C3 15.3181 3.67945 17.3636 4.79726 18.976C4.79726 19 4.81918 19 4.8411 19C4.86301 19 4.86301 18.976 4.8411 18.9519C4.16164 16.6657 7.60274 11.1549 9.37808 8.84461L9.4 8.82055C9.4 8.80814 9.4 8.80213 9.397 8.79922C9.39417 8.79648 9.3887 8.79648 9.37808 8.79648C6.68219 5.86055 5.78356 6.1734 5.63014 6.24559ZM15.8001 8.81061L15.822 8.78652C18.5179 5.87182 19.4165 6.18497 19.548 6.23315C19.5572 6.23315 19.5625 6.23315 19.5672 6.23488C19.5737 6.23731 19.5791 6.24316 19.5919 6.25723C21.2138 8.01569 22.2001 10.4486 22.2001 13.1225C22.2001 15.3145 21.5206 17.362 20.4028 18.976C20.4028 19 20.3809 19 20.359 19V18.9519C21.0165 16.6635 17.5974 11.1472 15.822 8.8347C15.8001 8.8347 15.8001 8.81061 15.8001 8.81061Z" fill="#515151"/>
                </svg>`,
            nintendo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 16" aria-label="nintendo platform icon">
                <path fill="#FFF" fill-rule="evenodd" d="M8 0h5a8 8 0 110 16H8A8 8 0 118 0zm-.135 1.935a6.065 6.065 0 000 12.13h5.12a6.065 6.065 0 000-12.13h-5.12zm-1.33 2.304h2.401l3.199 5.175V4.24h2.346v7.495H12.18L8.864 6.537v5.201H6.53l.005-7.499z"/>
                </svg>`,
            linux: `<svg width="22" height="22" viewBox="0 0 15 18" xmlns="http://www.w3.org/2000/svg" aria-label="linux platform icon">
                <path d="M14.52 14.452c-.513-.216-.733-.503-.712-.93.022-.5-.254-.866-.385-1.01.079-.312.31-1.386 0-2.32-.334-.999-1.352-2.525-2.403-4.025-.43-.616-.45-1.285-.474-2.06-.022-.74-.048-1.579-.45-2.51C9.66.582 8.785 0 7.694 0a3.23 3.23 0 00-1.829.572c-1.05.744-.91 2.366-.819 3.44.013.147.024.286.031.404.061 1.052.006 1.606-.067 1.774-.047.11-.279.423-.524.755-.254.343-.541.732-.777 1.094-.281.436-.508 1.103-.728 1.747-.16.471-.312.917-.46 1.183-.28.512-.21.99-.152 1.21-.106.076-.259.225-.388.505-.156.342-.473.526-1.132.657-.303.063-.512.194-.621.388-.16.283-.073.638.006.881.117.357.044.583-.088.993-.03.095-.065.202-.1.32a.59.59 0 00.06.504c.248.391.974.529 1.722.62.447.054.935.237 1.408.415.463.173.942.353 1.377.408.066.008.131.012.195.012.657 0 .954-.447 1.048-.631a11.36 11.36 0 011.889-.23 8 8 0 
                011.878.199c.072.142.262.466.566.633.166.093.398.147.636.147.254 0 .737-.062 1.119-.475.38-.414 1.333-.944 2.029-1.33.155-.087.3-.167.427-.24.39-.223.604-.54.585-.872a.735.735 0 00-.463-.63zm-8.647-.08c-.049-.351-.49-.7-1-1.104-.417-.33-.89-.705-1.02-1.022-.27-.654-.057-1.804.313-2.396.183-.296.332-.746.477-1.18.156-.47.317-.956.497-1.168.286-.332.55-.978.597-1.486.267.262.682.595 1.066.595a.613.613 0 00.17-.024c.263-.078.649-.307 1.022-.528.322-.191.718-.426.868-.448.256.378 1.743 3.757 1.895 4.842a5.266 5.266 0 01-.071 1.847 1.289 1.289 0 00-.177-.013c-.414 0-.524.232-.552.37-.074.36-.082 1.512-.082 1.771-.15.195-.908 1.116-1.995 1.281-.443.066-.857.1-1.23.1-.318 0-.521-.026-.606-.039l-.546-.642c.215-.109.43-.34.374-.755zm.693-10.586a.863.863 0 00-.05.024 1.073 1.073 0 00-.011-.115c-.06-.353-.288-.609-.542-.609a.373.373 0 00-.058.005c-.151.026-.27.142-.335.308.057-.363.257-.631.495-.631.278 0 .514.385.514.842 0 .057-.004.115-.013.176zm2.166.272a.916.916 0 00.04-.268c0-.414-.256-.738-.583-.738-.319 0-.578.331-.578.738 0 .028 0 .056.003.084a10.386 10.386 0 00-.05-.02A1.156 1.156 0 017.51 3.5c0-.495.308-.898.686-.898.38 0 .687.403.687.898 0 .206-.055.403-.15.559zm-.28.963c-.005.025-.016.036-.145.105a3.894 3.894 0 00-.246.14l-.067.043c-.272.168-.907.564-1.079.587-.117.016-.19-.03-.352-.144a5.075 5.075 0 00-.118-.08c-.293-.198-.482-.416-.503-.501.095-.076.333-.266.454-.379.247-.235.495-.393.617-.393l.019.001c.144.027.5.172.76.279.12.049.224.092.297.118.23.082.35.185.364.224zM10.52 16.02c.13-.6.279-1.418.255-1.9-.006-.11-.015-.229-.024-.344-.017-.215-.043-.535-.017-.63a.11.11 0 01.018-.007c0 .276.06.825.487 1.017.128.057.273.086.433.086.429 0 .904-.216 1.1-.416a2.05 2.05 0 00.278-.376.465.465 0 01.02.177c-.026.406.166.945.532 1.144l.053.029c.13.07.477.257.482.345 0 0-.003.01-.022.03-.087.08-.392.24-.687.395-.524.275-1.117.586-1.384.874-.375.406-.8.678-1.056.678a.27.27 0 01-.084-.012c-.278-.09-.507-.502-.384-1.09zm-9.49-1.533c-.028-.136-.05-.244-.026-.348.017-.078.39-.16.548-.196.223-.05.454-.101.605-.195.204-.127.314-.361.412-.568.07-.15.143-.304.23-.354a.048.048 0 01.027-.007c.162 0 .503.351.7.665.05.08.142.238.248.421.32.55.757 1.3.985 1.553.206.226.54.661.457 1.035-.06.29-.379.525-.454.577a.454.454 0 01-.101.01c-.438 0-1.303-.374-1.768-.574l-.068-.03c-.26-.112-.684-.182-1.094-.25-.326-.055-.772-.129-.846-.196-.06-.069.01-.294.07-.492.045-.142.09-.29.115-.444a1.634 1.634 0 00-.04-.607z" fill="#FFF"/>
                </svg>`,
            mac: `<svg width="22" height="22" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 18" aria-label="mac platform icon">
                <path d="M10.869 0h.127c.102 1.26-.379 2.202-.963 2.884-.574.677-1.359 1.334-2.629 1.234-.084-1.242.397-2.114.98-2.794C8.927.69 9.919.126 10.87 0zm3.756 13.196v.036a10.534 10.534 0 01-1.494 2.899c-.57.789-1.267 1.85-2.513 1.85-1.077 0-1.792-.696-2.896-.715-1.167-.02-1.81.583-2.877.734h-.364c-.783-.114-1.416-.74-1.877-1.302A11.452 11.452 0 010 10.134v-.808c.083-1.969 1.033-3.57 2.295-4.345.667-.413 1.583-.764 2.603-.607.437.068.884.219 1.275.368.371.144.835.398 1.275.385.298-.009.594-.165.894-.275.88-.32 1.74-.687 2.877-.514 1.365.207 2.334.818 2.933 1.76-1.155.74-2.068 1.855-1.912 3.76.138 1.73 1.137 2.742 2.385 3.338z" fill="#FFF"/>
                </svg>`,
            android: `<svg width="22" height="22" viewBox="0 0 16 18" xmlns="http://www.w3.org/2000/svg" aria-label="android platform icon">
                <path d="M1.168 5.86H1.12c-.614 0-1.115.482-1.115 1.07v4.665c0 .59.5 1.071 1.115 1.071h.049c.614 0 1.115-.482 1.115-1.071V6.93c0-.589-.502-1.072-1.116-1.072zm1.65 7.535c0 .541.46.983 1.025.983h1.095v2.519c0 .591.503 1.073 1.116 1.073h.048c.615 0 1.116-.482 1.116-1.073v-2.52H8.75v2.52c0 .591.504 1.073 1.117 1.073h.047c.615 0 1.116-.482 1.116-1.073v-2.52h1.096c.564 0 1.025-.44 1.025-.982V6.03H2.818v7.364zm7.739-11.83l.87-1.29a.173.173 0 00-.054-.246.188.188 0 00-.256.052l-.902 1.335A6.092 6.092 0 007.985 1a6.1 6.1 0 00-2.232.416L4.853.08a.19.19 0 00-.257-.05.173.173 0 00-.055.246l.871 1.29c-1.57.739-2.628 2.131-2.628 3.729 0 .098.006.195.015.29H13.17c.009-.095.014-.192.014-.29 0-1.598-1.059-2.99-2.628-3.73zM5.58 3.875a.489.489 0 01-.5-.48c0-.265.224-.478.5-.478.277 0 .5.213.5.478a.489.489 0 01-.5.48zm4.809 0a.489.489 0 01-.5-.48c0-.265.224-.478.5-.478s.498.213.498.478a.488.488 0 01-.498.48zm4.458 1.985h-.046c-.614 0-1.117.482-1.117 1.07v4.665c0 .59.503 1.071 1.117 1.071h.047c.615 0 1.115-.482 1.115-1.071V6.93c0-.589-.501-1.072-1.116-1.072z" fill="#FFF"/>
                </svg>`
        };

        const favoriteHeart = `
            <svg class="favoriteHeart" width="34" height="33" viewBox="0 0 34 33" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="add to wishlist icon">
                <g filter="url(#filter0_d_11124_9524)">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.3335 9.33336C10.4802 9.33336 9.00016 10.8174 9.00016 12.6227C9.00016 14.6547 10.1762 16.8227 11.9948 18.9467C13.5228 20.7294 15.3788 22.3374 17.0002 23.6347C18.6215 22.3374 20.4775 20.728 22.0055 18.9467C23.8242 16.8227 25.0002 14.6534 25.0002 12.6227C25.0002 10.8174 23.5202 9.33336 21.6668 9.33336C19.8135 9.33336 18.3335 10.8174 18.3335 12.6227C18.3335 12.9763 18.193 13.3155 17.943 13.5655C17.6929 13.8156 17.3538 13.956 17.0002 13.956C16.6465 13.956 16.3074 13.8156 16.0574 13.5655C15.8073 13.3155 15.6668 12.9763 15.6668 12.6227C15.6668 10.8174 14.1868 9.33336 12.3335 9.33336ZM17.0002 8.87869C16.4356 8.18636 15.7238 7.62859 14.9165 7.24595C14.1092 6.86331 13.2268 6.66543 12.3335 6.66669C9.03216 6.66669 6.3335 9.32003 6.3335 12.6227C6.3335 15.624 8.02283 18.4094 9.9695 20.6814C11.9442 22.9867 14.3655 24.972 16.1815 26.3854C16.4156 26.5674 16.7036 26.6663 17.0002 26.6663C17.2967 26.6663 17.5848 26.5674 17.8188 26.3854C19.6348 24.972 22.0562 22.9854 24.0308 20.6814C25.9775 18.4094 27.6668 15.624 27.6668 12.6227C27.6668 9.32003 24.9682 6.66669 21.6668 6.66669C19.7868 6.66669 18.1015 7.52803 17.0002 8.87869Z" fill="white"/>
                </g>
                <defs>
                    <filter id="filter0_d_11124_9524" x="-5" y="-6" width="44" height="43.9984" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                        <feOffset/>
                        <feGaussianBlur stdDeviation="3"/>
                        <feComposite in2="hardAlpha" operator="out"/>
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.6 0"/>
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_11124_9524"/>
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_11124_9524" result="shape"/>
                    </filter>
                </defs>
            </svg>`;

        for (let i = 0; i < cardsArray.length; i++) {
            let element = cardsArray[i];
            let genres = [];
            let platforms = [];
            let releaseDate = element.released;
            const date = new Date(releaseDate);
            const monthNames = [
                "January",
                "February",
                "March",
                "April",
                "May",
                "June",
                "July",
                "August",
                "September",
                "October",
                "November",
                "December"
            ];

            element.genres.forEach((genre) => genres.push(genre.name));

            element.parent_platforms.forEach((platform) => {
                if (PLATFORM_ICONS[platform.platform.slug]) {
                    platforms.push(PLATFORM_ICONS[platform.platform.slug]);
                }
            });

            const day = date.getDate();
            const month = monthNames[date.getMonth()];
            const year = date.getFullYear();

            releaseDate = `${month} ${day}, ${year}`;

            //prettier-ignore
            gamesTemplate += `
                <div class="game-card">
                    <div class="game-card--img-container">
                        <img src="${element.background_image}" alt="${element.name} cover picture">
                        ${favoriteHeart}
                    </div>
                    <div class="game-card--title-section">
                        <h3 class="game-card--title">${element.name}</h3>
                        <p class="game-card--id">#${element.id}</p>
                    </div>
                    <div class="game-card--body">
                        <div class="game-card--info-container">
                            <div class="game-card--info">
                                <h5 class="game-card--info-release">Release date:</h5>
                                <h6 class="game-card--info-content">
                                    ${releaseDate}
                                </h6>
                            </div>
                            <div class="game-card--info">
                                <h5 class="game-card--info-release">Genres:</h5>
                                <h6 class="game-card--info-content">
                                    ${genres.join(", ")}
                                </h6>
                            </div>
                        </div>
                        <div class="platforms-container">
                            ${platforms.join("")}
                        </div>
                    </div>
                </div>
            `;
        }
        CARDS_CONTAINER.innerHTML = gamesTemplate;
    }
    displayGames();
})();
